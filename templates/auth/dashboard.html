{% extends "base.html" %}

{% block title %}Dashboard | OGSP{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Dashboard</h1>
    <p class="text-gray-500 mt-1">Welcome back, {{ current_user.username }}</p>
</div>

<!-- User Overview / Quick Stats -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">

    <!-- Groups Joined -->
    <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-sm text-gray-500">Groups Joined</h3>
        <p class="text-3xl font-bold text-blue-600 mt-2">{{ groups_count | default(0) }}</p>
    </div>

    <!-- Courses -->
    <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-sm text-gray-500">Courses</h3>
        <p class="text-3xl font-bold text-green-600 mt-2">{{ courses_count | default(0) }}</p>
    </div>

    <!-- Members -->
    <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-sm text-gray-500">Members</h3>
        <p class="text-3xl font-bold text-purple-600 mt-2">{{ members_count | default(0) }}</p>
    </div>

    <!-- Unread Notifications -->
    <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-sm text-gray-500">Unread Notifications</h3>
        <p class="text-3xl font-bold text-red-600 mt-2">{{ unread_notifications | default(0) }}</p>
    </div>
</div>

<!-- Profile Card -->
<div class="lg:col-span-3 bg-white rounded-xl shadow p-6 flex items-center space-x-6 mb-10">
    <div class="relative">
        <img src="{{ url_for('static', filename='uploads/profile_pics/' + (current_user.profile_pic or 'profile-placeholder.jpg')) }}"
             alt="Profile"
             class="w-20 h-20 rounded-full border-2 border-blue-600 object-cover">
        <!-- Upload Button -->
        <form action="{{ url_for('dashboard.upload_profile') }}" method="POST" enctype="multipart/form-data" class="absolute bottom-0 right-0">
            <label for="profile_pic" class="cursor-pointer bg-blue-600 text-white text-xs px-2 py-1 rounded-full hover:bg-blue-700 transition">
                Change
            </label>
            <input type="file" name="profile_pic" id="profile_pic" class="hidden" onchange="this.form.submit()">
        </form>
    </div>
    <div>
        <h2 class="text-xl font-semibold">{{ current_user.username }}</h2>
        <p class="text-gray-500">Member since {{ current_user.created_at.strftime('%b %d, %Y') }}</p>
        <p class="mt-2 text-gray-700">
            Last active: {{ current_user.last_active.strftime('%b %d, %Y %H:%M') }}
        </p>
    </div>
</div>

<!-- Recent Activity & Online Users -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">

    <!-- Recent Activity Feed -->
    <div class="lg:col-span-2 bg-white rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold mb-4">Recent Activity</h2>
        {% if activities %}
            <ul class="space-y-3 text-sm text-gray-600">
                {% for activity in activities %}
                    <li class="border-b pb-2">
                        {{ activity }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-sm text-gray-500">No recent activity yet.</p>
        {% endif %}
    </div>

    <!-- Online Members -->
    <div class="bg-white rounded-xl shadow p-6">
        <h2 class="text-lg font-semibold mb-4">Online Members</h2>
        {% if online_users %}
            <ul class="space-y-2 text-sm text-gray-700">
                {% for user in online_users %}
                    <li class="flex items-center space-x-2">
                        <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                        <span>{{ user.username }}</span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-gray-500">No members online currently.</p>
        {% endif %}
    </div>
</div>

<!-- ================= QUICK ACTIONS ================= -->
<section class="mt-8">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">
        Quick Actions
    </h3>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">

        <!-- Create Group -->
        <a href="{{ url_for('groups.create_group') }}"
           class="group bg-white rounded-xl p-5 shadow-sm border border-gray-100
                  hover:shadow-lg hover:-translate-y-1 transition-all duration-200">

            <div class="text-3xl mb-3">â•</div>

            <h4 class="text-base font-semibold text-gray-900 group-hover:text-indigo-600">
                Create Group
            </h4>

            <p class="text-sm text-gray-500 mt-1">
                Start a new study group
            </p>
        </a>

        <!-- Join Group -->
        <a href="{{ url_for('groups.list_groups') }}"
           class="group bg-white rounded-xl p-5 shadow-sm border border-gray-100
                  hover:shadow-lg hover:-translate-y-1 transition-all duration-200">

            <div class="text-3xl mb-3">ğŸ‘¥</div>

            <h4 class="text-base font-semibold text-gray-900 group-hover:text-indigo-600">
                Join Group
            </h4>

            <p class="text-sm text-gray-500 mt-1">
                Find and join existing groups
            </p>
        </a>

        <!-- Quiz -->
        <a href="{{ url_for('quiz.courses') }}"
           class="group bg-white rounded-xl p-5 shadow-sm border border-gray-100
                  hover:shadow-lg hover:-translate-y-1 transition-all duration-200">

            <div class="text-3xl mb-3">ğŸ“</div>

            <h4 class="text-base font-semibold text-gray-900 group-hover:text-indigo-600">
                Take Quiz
            </h4>

            <p class="text-sm text-gray-500 mt-1">
                Test your knowledge
            </p>
        </a>

        <!-- My Groups -->
        <a href="{{ url_for('groups.list_groups') }}"
           class="group bg-white rounded-xl p-5 shadow-sm border border-gray-100
                  hover:shadow-lg hover:-translate-y-1 transition-all duration-200">

            <div class="text-3xl mb-3">ğŸ“š</div>

            <h4 class="text-base font-semibold text-gray-900 group-hover:text-indigo-600">
                My Groups
            </h4>

            <p class="text-sm text-gray-500 mt-1">
                View your study groups
            </p>
        </a>

    </div>
</section>
<!-- ================= END QUICK ACTIONS ================= -->

<!-- Featured Courses -->
<div class="mb-10">
    <h2 class="text-xl font-semibold mb-4">Featured Courses</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {% for course in featured_courses %}
            <div class="bg-white rounded-xl shadow p-4 hover:shadow-lg transition">
                <img src="{{ url_for('static', filename='images/course-placeholder.jpg') }}" alt="{{ course.title }}" class="rounded-md mb-2 w-full h-32 object-cover">
                <h3 class="text-md font-semibold">{{ course.title }}</h3>
                <p class="text-sm text-gray-500">{{ course.short_description }}</p>
            </div>
        {% endfor %}
        {% if featured_courses|length == 0 %}
            <p class="text-gray-500 col-span-4">No featured courses yet.</p>
        {% endif %}
    </div>
</div>

{% endblock %}
